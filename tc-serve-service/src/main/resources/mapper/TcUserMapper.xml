<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tcxx.serve.service.mapper.TcUserMapper">

    <resultMap id="BaseResultMap" type="com.tcxx.serve.service.entity.TcUser">
        <result column="id" property="id" />
        <result column="nick_name" property="nickName" />
        <result column="head_img_url" property="headImgUrl" />
        <result column="sex" property="sex" />
        <result column="province" property="province" />
        <result column="city" property="city" />
        <result column="county" property="county" />
        <result column="open_id" property="openId" />
        <result column="union_id" property="unionId" />
        <result column="access_token" property="accessToken" />
        <result column="refresh_token" property="refreshToken" />
        <result column="modified" property="modified" />
        <result column="created" property="created" />
    </resultMap>

    <sql id="TbName">
        tc_user
    </sql>

    <!-- 用于select查询、insert的公用抽取的列 -->
    <sql id="TbColumns">
		id,nick_name,head_img_url,sex,province,city,county,open_id,union_id,access_token,refresh_token,modified,created
	</sql>

    <insert id="insert" parameterType="com.tcxx.serve.service.entity.TcUser">
        INSERT INTO <include refid="TbName"/> (
        <include refid="TbColumns"/>
        )  VALUES (
        #{id},
        #{nickName},
        #{headImgUrl},
        #{sex},
        #{province},
        #{city},
        #{county},
        #{openId},
        #{unionId},
        #{accessToken},
        #{refreshToken},
        NOW(),
        NOW()
        )
    </insert>

    <select id="getByUserId" resultMap="BaseResultMap" parameterType="com.tcxx.serve.service.query.TcUserQuery" >
        SELECT <include refid="TbColumns"/>
        FROM <include refid="TbName"/>
        WHERE
          id = #{id}
    </select>

    <update id="updateAccessTokenAndRefreshToken" parameterType="com.tcxx.serve.service.query.TcUserQuery" >
		UPDATE <include refid="TbColumns"/>
		SET
		  access_token = #{accessToken},
          refresh_token = #{refreshToken},
          modified = now()
		WHERE
		    id = #{id}
	</update>

</mapper>